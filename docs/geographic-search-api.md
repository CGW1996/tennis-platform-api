# åœ°ç†æœå°‹ API æ–‡æª”

## æ¦‚è¿°

ç¶²çƒå¹³å°çš„åœ°ç†æœå°‹åŠŸèƒ½æä¾›äº†å¼·å¤§çš„å ´åœ°æœå°‹èƒ½åŠ›ï¼Œæ”¯æ´åŸºæ–¼åœ°ç†ä½ç½®çš„æœå°‹ã€æ–‡å­—æœå°‹ã€å¤šç¶­åº¦ç¯©é¸å’Œæ™ºèƒ½æ’åºã€‚

## æŠ€è¡“æ¶æ§‹

### é›™é‡æœå°‹å¼•æ“
- **ä¸»è¦å¼•æ“**: Elasticsearch - æä¾›é«˜æ€§èƒ½çš„åœ°ç†æœå°‹å’Œå…¨æ–‡æœå°‹
- **å›é€€å¼•æ“**: PostgreSQL + PostGIS - ç•¶ Elasticsearch ä¸å¯ç”¨æ™‚çš„å‚™ç”¨æ–¹æ¡ˆ

### æœå°‹å„ªå…ˆç´š
1. å¦‚æœæœ‰åœ°ç†ä½ç½®åƒæ•¸æˆ–æ–‡å­—æœå°‹ï¼Œå„ªå…ˆä½¿ç”¨ Elasticsearch
2. å¦‚æœ Elasticsearch ä¸å¯ç”¨ï¼Œè‡ªå‹•å›é€€åˆ° PostgreSQL
3. ç´”ç¯©é¸æŸ¥è©¢å¯ä»¥ä½¿ç”¨ä»»ä¸€å¼•æ“

## API ç«¯é»

### æœå°‹å ´åœ°
```
GET /api/v1/courts
```

## è«‹æ±‚åƒæ•¸

| åƒæ•¸å | é¡å‹ | å¿…å¡« | æè¿° | ç¯„ä¾‹ |
|--------|------|------|------|------|
| `query` | string | å¦ | æ–‡å­—æœå°‹ï¼ˆå ´åœ°åç¨±ã€æè¿°ã€åœ°å€ï¼‰ | `ç¶²çƒå ´` |
| `latitude` | float | å¦ | ç·¯åº¦ (-90 åˆ° 90) | `25.0330` |
| `longitude` | float | å¦ | ç¶“åº¦ (-180 åˆ° 180) | `121.5654` |
| `radius` | float | å¦ | æœå°‹åŠå¾‘ï¼ˆå…¬é‡Œï¼Œ0-100ï¼‰ | `5.0` |
| `minPrice` | float | å¦ | æœ€ä½åƒ¹æ ¼ | `500` |
| `maxPrice` | float | å¦ | æœ€é«˜åƒ¹æ ¼ | `1500` |
| `courtType` | string | å¦ | å ´åœ°é¡å‹ | `hard`, `clay`, `grass`, `indoor`, `outdoor` |
| `facilities` | array | å¦ | è¨­æ–½åˆ—è¡¨ | `parking`, `lighting`, `restroom` |
| `minRating` | float | å¦ | æœ€ä½è©•åˆ† (0-5) | `4.0` |
| `sortBy` | string | å¦ | æ’åºæ¬„ä½ | `distance`, `price`, `rating`, `name` |
| `sortOrder` | string | å¦ | æ’åºé †åº | `asc`, `desc` |
| `page` | int | å¦ | é ç¢¼ï¼ˆé è¨­: 1ï¼‰ | `1` |
| `pageSize` | int | å¦ | æ¯é æ•¸é‡ï¼ˆé è¨­: 20ï¼Œæœ€å¤§: 100ï¼‰ | `20` |

## å›æ‡‰æ ¼å¼

```json
{
  "courts": [
    {
      "id": "court-uuid",
      "name": "å°åŒ—ç¶²çƒä¸­å¿ƒ",
      "description": "å°ˆæ¥­ç¶²çƒå ´åœ°",
      "address": "å°åŒ—å¸‚ä¿¡ç¾©å€ä¿¡ç¾©è·¯äº”æ®µ7è™Ÿ",
      "latitude": 25.0330,
      "longitude": 121.5654,
      "facilities": ["parking", "lighting", "restroom"],
      "courtType": "hard",
      "pricePerHour": 800,
      "currency": "TWD",
      "images": ["https://example.com/image1.jpg"],
      "operatingHours": {
        "monday": "06:00-22:00",
        "tuesday": "06:00-22:00"
      },
      "contactPhone": "+886-2-1234-5678",
      "contactEmail": "info@tenniscenter.com",
      "website": "https://tenniscenter.com",
      "averageRating": 4.5,
      "totalReviews": 128,
      "isActive": true,
      "createdAt": "2024-01-01T00:00:00Z",
      "updatedAt": "2024-01-01T00:00:00Z",
      "distance": 2.5
    }
  ],
  "total": 150,
  "page": 1,
  "pageSize": 20,
  "totalPages": 8
}
```

## æœå°‹å ´æ™¯ç¯„ä¾‹

### 1. åŸºæœ¬åœ°ç†ä½ç½®æœå°‹
```bash
curl "http://localhost:8080/api/v1/courts?latitude=25.0330&longitude=121.5654&radius=5"
```

### 2. æ–‡å­—æœå°‹
```bash
curl "http://localhost:8080/api/v1/courts?query=ç¶²çƒä¸­å¿ƒ"
```

### 3. ç¶œåˆæœå°‹
```bash
curl "http://localhost:8080/api/v1/courts?query=ç¶²çƒ&latitude=25.0330&longitude=121.5654&radius=10&courtType=hard&facilities=parking&minPrice=500&maxPrice=1500&minRating=4.0&sortBy=distance&sortOrder=asc"
```

### 4. åƒ¹æ ¼ç¯©é¸
```bash
curl "http://localhost:8080/api/v1/courts?minPrice=500&maxPrice=1000&sortBy=price&sortOrder=asc"
```

### 5. è¨­æ–½ç¯©é¸
```bash
curl "http://localhost:8080/api/v1/courts?facilities=parking&facilities=lighting"
```

## æ’åºé¸é …

### è·é›¢æ’åº (`sortBy=distance`)
- éœ€è¦æä¾› `latitude` å’Œ `longitude` åƒæ•¸
- æŒ‰ç…§èˆ‡æŒ‡å®šä½ç½®çš„è·é›¢æ’åº
- è·é›¢ä»¥å…¬é‡Œç‚ºå–®ä½é¡¯ç¤ºåœ¨å›æ‡‰ä¸­

### åƒ¹æ ¼æ’åº (`sortBy=price`)
- æŒ‰ç…§æ¯å°æ™‚åƒ¹æ ¼æ’åº
- æ”¯æ´å‡åº (`asc`) å’Œé™åº (`desc`)

### è©•åˆ†æ’åº (`sortBy=rating`)
- æŒ‰ç…§å¹³å‡è©•åˆ†æ’åº
- é è¨­ç‚ºé™åºï¼ˆé«˜è©•åˆ†å„ªå…ˆï¼‰

### åç¨±æ’åº (`sortBy=name`)
- æŒ‰ç…§å ´åœ°åç¨±å­—æ¯é †åºæ’åº

## è¨­æ–½é¡å‹

| è¨­æ–½ä»£ç¢¼ | ä¸­æ–‡åç¨± | åœ–ç¤º |
|----------|----------|------|
| `parking` | åœè»Šå ´ | ğŸ…¿ï¸ |
| `restroom` | æ´—æ‰‹é–“ | ğŸš» |
| `shower` | æ·‹æµ´é–“ | ğŸš¿ |
| `locker` | ç½®ç‰©æ«ƒ | ğŸ—„ï¸ |
| `pro_shop` | å°ˆæ¥­ç”¨å“åº— | ğŸª |
| `restaurant` | é¤å»³ | ğŸ½ï¸ |
| `lighting` | å¤œé–“ç…§æ˜ | ğŸ’¡ |
| `air_condition` | ç©ºèª¿ | â„ï¸ |
| `equipment_rent` | å™¨æç§Ÿå€Ÿ | ğŸ¾ |
| `coaching` | æ•™ç·´æœå‹™ | ğŸ‘¨â€ğŸ« |
| `wifi` | ç„¡ç·šç¶²è·¯ | ğŸ“¶ |
| `wheelchair` | ç„¡éšœç¤™è¨­æ–½ | â™¿ |

## å ´åœ°é¡å‹

| é¡å‹ä»£ç¢¼ | ä¸­æ–‡åç¨± | æè¿° |
|----------|----------|------|
| `hard` | ç¡¬åœ°çƒå ´ | æœ€å¸¸è¦‹çš„çƒå ´é¡å‹ï¼Œé©åˆå„ç¨®æ‰“æ³• |
| `clay` | ç´…åœŸçƒå ´ | çƒé€Ÿè¼ƒæ…¢ï¼Œé©åˆåº•ç·šå‹çƒå“¡ |
| `grass` | è‰åœ°çƒå ´ | çƒé€Ÿå¿«ï¼Œå½ˆè·³ä½ï¼Œé©åˆç™¼çƒä¸Šç¶² |
| `indoor` | å®¤å…§çƒå ´ | ä¸å—å¤©æ°£å½±éŸ¿ï¼Œå…¨å¹´å¯ç”¨ |
| `outdoor` | å®¤å¤–çƒå ´ | è‡ªç„¶ç’°å¢ƒï¼Œé€šå¸¸åƒ¹æ ¼è¼ƒä¾¿å®œ |

## éŒ¯èª¤è™•ç†

### å¸¸è¦‹éŒ¯èª¤ç¢¼

| ç‹€æ…‹ç¢¼ | éŒ¯èª¤é¡å‹ | æè¿° |
|--------|----------|------|
| 400 | Bad Request | è«‹æ±‚åƒæ•¸éŒ¯èª¤ |
| 500 | Internal Server Error | æœå‹™å™¨å…§éƒ¨éŒ¯èª¤ |

### éŒ¯èª¤å›æ‡‰æ ¼å¼
```json
{
  "error": "è«‹æ±‚åƒæ•¸éŒ¯èª¤",
  "details": "latitude must be between -90 and 90"
}
```

## æ€§èƒ½å„ªåŒ–

### Elasticsearch å„ªåŒ–
- ä½¿ç”¨åœ°ç†ä½ç½®ç´¢å¼• (`geo_point`)
- æ”¯æ´åœ°ç†è·é›¢ç¯©é¸å’Œæ’åº
- å…¨æ–‡æœå°‹ä½¿ç”¨ `multi_match` æŸ¥è©¢
- æ”¯æ´å¤šç¶­åº¦ç¯©é¸çµ„åˆ

### PostgreSQL å›é€€å„ªåŒ–
- ä½¿ç”¨ PostGIS æ“´å±•é€²è¡Œåœ°ç†è¨ˆç®—
- åœ°ç†ä½ç½®ç´¢å¼• (`GIST` ç´¢å¼•)
- Haversine å…¬å¼è¨ˆç®—ç²¾ç¢ºè·é›¢

### ç·©å­˜ç­–ç•¥
- ç†±é–€æœå°‹çµæœç·©å­˜
- åœ°ç†ä½ç½®è¨ˆç®—çµæœç·©å­˜
- è¨­æ–½å’Œé¡å‹åˆ—è¡¨ç·©å­˜

## ç®¡ç†åŠŸèƒ½

### æ‰¹é‡ç´¢å¼•
```bash
curl -X POST "http://localhost:8080/api/v1/courts/bulk-index" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

ç”¨æ–¼å°‡ç¾æœ‰å ´åœ°æ‰¹é‡ç´¢å¼•åˆ° Elasticsearchã€‚

## ç›£æ§å’Œæ—¥èªŒ

### å¥åº·æª¢æŸ¥
- Elasticsearch é€£æ¥ç‹€æ…‹
- PostgreSQL é€£æ¥ç‹€æ…‹
- ç´¢å¼•ç‹€æ…‹æª¢æŸ¥

### æ€§èƒ½æŒ‡æ¨™
- æœå°‹éŸ¿æ‡‰æ™‚é–“
- ç´¢å¼•æ›´æ–°å»¶é²
- ç·©å­˜å‘½ä¸­ç‡

### éŒ¯èª¤æ—¥èªŒ
- Elasticsearch é€£æ¥å¤±æ•—
- ç´¢å¼•æ“ä½œå¤±æ•—
- æœå°‹æŸ¥è©¢éŒ¯èª¤

## é–‹ç™¼å’Œæ¸¬è©¦

### æ¸¬è©¦è…³æœ¬
ä½¿ç”¨ `test_geographic_search.sh` è…³æœ¬é€²è¡ŒåŠŸèƒ½æ¸¬è©¦ï¼š

```bash
./test_geographic_search.sh
```

### æœ¬åœ°é–‹ç™¼
1. å•Ÿå‹• Docker Compose ç’°å¢ƒ
2. ç¢ºä¿ Elasticsearch æœå‹™æ­£å¸¸é‹è¡Œ
3. åŸ·è¡Œæ‰¹é‡ç´¢å¼•åˆå§‹åŒ–æ•¸æ“š
4. ä½¿ç”¨æ¸¬è©¦è…³æœ¬é©—è­‰åŠŸèƒ½

## æœªä¾†æ“´å±•

### è¨ˆåŠƒåŠŸèƒ½
- åœ°ç†åœæ¬„æœå°‹
- ç†±åŠ›åœ–é¡¯ç¤º
- å¯¦æ™‚å¯ç”¨æ€§æŸ¥è©¢
- å€‹æ€§åŒ–æ¨è–¦æ’åº
- æœå°‹æ­·å²å’Œåå¥½å­¸ç¿’

### æ€§èƒ½æå‡
- æœå°‹çµæœé è¼‰å…¥
- æ™ºèƒ½ç·©å­˜ç­–ç•¥
- åˆ†æ•£å¼æœå°‹æ¶æ§‹
- æ©Ÿå™¨å­¸ç¿’æ’åºå„ªåŒ–